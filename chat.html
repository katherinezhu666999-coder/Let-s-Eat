<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>AI陪伴对话 | 食光机 Let's Eat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
<style>
  :root{--primary:#a8c0ff;--accent:#d4a5e0;--bg:#faf8ff;--text:#4a4a68;}
  body{font-family:'Noto Sans SC',sans-serif;background:var(--bg);color:var(--text);margin:0;}
  header{position:fixed;top:0;left:0;right:0;background:rgba(255,255,255,0.9);backdrop-filter:blur(12px);z-index:1000;padding:1rem 5%;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 20px rgba(168,192,255,.2);}
  .logo{font-size:1.8rem;font-weight:700;color:var(--primary);}
  nav ul{display:flex;gap:2rem;list-style:none;}
  nav a:hover{background:var(--accent);color:white;border-radius:50px;padding:0.5rem 1rem;}
  main{margin-top:90px;padding:2rem 5%;min-height:100vh;display:flex;flex-direction:column;}
  .chat-container{max-width:900px;margin:0 auto;background:white;border-radius:24px;box-shadow:0 15px 40px rgba(168,192,255,.2);flex:1;display:flex;flex-direction:column;}
  .chat-messages{flex:1;padding:2rem;overflow-y:auto;}
  .message{padding:1rem 1.5rem;margin:0.8rem 0;border-radius:20px;max-width:80%;word-wrap:break-word;line-height:1.6;}
  .user{background:var(--accent);color:white;align-self:flex-end;}
  .ai{background:#f0e8ff;color:#4a4a68;align-self:flex-start;}
  .input-area{display:flex;padding:1rem;background:#f9f5ff;border-top:1px solid #eee;}
  #userInput{flex:1;padding:1rem;border-radius:50px;border:1px solid #ddd;outline:none;font-size:1rem;}
  button.send{background:var(--accent);color:white;border:none;width:50px;height:50px;border-radius:50%;margin-left:1rem;cursor:pointer;font-size:1.3rem;}
  .tip{background:#fff0f8;padding:1.5rem;border-radius:16px;margin:2rem;text-align:center;color:#666;}
  .typing{display:flex;align-items:center;gap:8px;color:#999;font-size:0.9rem;}
  footer{background:#4a4a68;color:#ddd;padding:2rem;text-align:center;font-size:0.9rem;}
</style>
</head>
<body>

<header>
  <div class="logo">食光机 Let's Eat</div>
  <nav><ul>
    <li><a href="index.html">首页</a></li>
    <li><a href="quiz.html">自测</a></li>
    <li><a href="games.html">小游戏</a></li>
    <li><a href="chat.html">AI聊天</a></li>
  </ul></nav>
</header>

<main>
  <div class="chat-container">
    <div class="chat-messages" id="messages">
      <div class="message ai">
        嗨，我是食光机的小助手～<br>
        这里是一个完全安全的空间，你可以把任何关于吃、情绪、体重、身体意象的想法都说出来，我不会评价你，只会陪着你。
      </div>
      <div class="tip">
        Warning: AI 不能代替专业医生或心理咨询师。<br>
        如有严重自伤念头或极端行为，请立刻前往医院或联系【寻求帮助】板块。
      </div>
    </div>

    <div class="input-area">
      <input type="text" id="userInput" placeholder="说点什么吧……比如“我刚刚又吃到很撑”" autocomplete="off">
      <button class="send" id="sendBtn">Send</button>
    </div>
  </div>
</main>

<footer>
  <p>© 2025 食光机 Let's Eat · ED Healer</p>
</footer>

<script>
  const messages = document.getElementById('messages');
  const input = document.getElementById('userInput');
  const sendBtn = document.getElementById('sendBtn');

  function addMessage(text, type) {
    const div = document.createElement('div');
    div.className = `message ${type}`;
    div.innerHTML = text.replace(/\n/g, '<br>');
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function showTyping() {
    const typing = document.createElement('div');
    typing.className = 'message ai typing';
    typing.innerHTML = '食光机小助手正在思考 <span class="dot1">.</span><span class="dot2">.</span><span class="dot3">.</span>';
    typing.id = 'typing';
    messages.appendChild(typing);
    messages.scrollTop = messages.scrollHeight;
  }

  function removeTyping() {
    const typing = document.getElementById('typing');
    if (typing) typing.remove();
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, 'user');
    input.value = '';
    showTyping();

    try {
      const res = await fetch('https://api.minimaxi.com/v1/chat/completions  ', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJHcm91cE5hbWUiOiJMTEwiLCJVc2VyTmFtZSI6IkxMTCIsIkFjY291bnQiOiIiLCJTdWJqZWN0SUQiOiIxOTg2MjAzNzUzMjMyOTk5MDg5IiwiUGhvbmUiOiIxNzg2NDI4ODgzNSIsIkdyb3VwSUQiOiIxOTg2MjAzNzUzMjI0NjEwNDgxIiwiUGFnZU5hbWUiOiIiLCJNYWlsIjoiIiwiQ3JlYXRlVGltZSI6IjIwMjUtMTEtMDYgMTg6NDk6NTIiLCJUb2tlblR5cGUiOjEsImlzcyI6Im1pbmltYXgifQ.Sr_ecxgozmMF1jGKXXP8i2Y1pJ_fKXUy7LnCT7r9WxFlnrSeHZyVheU4c1KukZFB879eElsn0GhmBu3ScxqaAT-b09Oq12R9dbTaSIJdh2rLVjcBT2o0rd2PU5blLWCzxZGQFZ0YY2GMEHr8UO4BijINq0CC9ClQiwjuGX2nLuDHfdeCr1I-O3CzarmVS-8MEi9klNW9QeghBBwB8l9WE78QsVVIEMlRF31boWWMJrBP7KePst9UgBCzCqsNv5K2yPup24KPIYU-Ld0zSOZKzbFbvdC1XWk3uxczG390AbK8qZvwcPuzUK8mh_Emk6hi-mjLnBh83XuEK7ZSHiMcaQ',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: "gpt-4o",
          messages: [
            { role: "system", content: "你是食光机的小助手，一个温暖、共情、绝不评判的进食障碍陪伴AI。你只提供情绪陪伴和支持，绝不给出饮食建议、医疗建议或体重建议。如发现用户有严重自伤风险，请温和但坚定地引导其立即就医或联系专业热线。" },
            { role: "user", content: text }
          ],
          temperature: 0.8,
          max_tokens: 800
        })
      });

      const data = await res.json();
      removeTyping();

      if (data.choices && data.choices[0].message.content) {
        addMessage(data.choices[0].message.content.trim(), 'ai');
      } else {
        addMessage('抱歉，我现在有点小卡顿…可以过一会儿再和我说吗？', 'ai');
      }
    } catch (err) {
      removeTyping();
      addMessage('网络好像出了点问题…可以稍后再试试吗？', 'ai');
      console.error(err);
    }
  }

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keypress', e => {
    if (e.key === 'Enter') sendMessage();
  });
</script>
</body>
</html>
